#!/usr/bin/env python3

from argparse import ArgumentParser, Namespace
from ipaddress import IPv4Address, ip_address
from os import environ
from subprocess import PIPE, run
from typing import List


def call_into(prog: str, *args: List[str]) -> bytes:
  ret = run([prog, *args], stdout=PIPE)
  if ret.returncode != 0:
    exit(ret.returncode)
  else:
    return ret.stdout


def parse_args() -> Namespace:
  parser = ArgumentParser()
  parser.add_argument("domain")
  parser.add_argument("state")
  parser.add_argument("extra", nargs="*")
  return parser.parse_args()


def ip_table(ip: IPv4Address, port: int) -> None:
  ["iptables",
   "--table", "filter",
   "--append", "FORWARD",
   "--protocol", "all",
   "--jump", "ACCEPT",
   "--destination", str(ip),
   "--destination-port", str(port)]

  ["iptables",
   "--table", "nat",
   "--append", "PREROUTING",
   "--protocol", "all",
   "--jump", "DNAT",
   "--to-destination", f"{ip}:{port}",
   "--destination-port", str(port)]


def main() -> None:
  args = parse_args()
  if args.state != "start":
    return


main()

