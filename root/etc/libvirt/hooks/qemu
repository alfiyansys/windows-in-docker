#!/usr/bin/with-contenv bash

set -eu
set -o pipefail


VM_IP="$(< /vmrc/ip_addr)"
VM_NET="$(< /vmrc/network)"


if [[ "$1" == "$VM_NAME" ]]
then
  if [[ "$2" = "stopped" ]] || [[ "$2" = "reconnect" ]]
  then
    route-nat --network "$VM_NET" --ip "$VM_IP" --state off
  fi

  if [[ "$2" = "start" ]] || [[ "$2" = "reconnect" ]]
  then
    route-nat --network "$VM_NET" --ip "$VM_IP" --state on
  fi
fi

